<!doctype html><html lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.82.0"><title>Remarkable Line Simplification • Techplex Labs</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Remarkable Line Simplification"><meta name=twitter:description content="I recently purchased a reMarkable 2 e-ink tablet with the goal of modernizing my note-taking process. My end goal is to make my handwritten notes searchable.
It seems the reMarkable is doing some sort of line simplification before sending the raw x, y coordinates to the MyScript Handwriting Recognition Service (HWR) service.
The following images show initial plotting of the line segments from the binary lines files vs the data sent by the tablet to the HWR service:"><meta property="og:title" content="Remarkable Line Simplification"><meta property="og:description" content="I recently purchased a reMarkable 2 e-ink tablet with the goal of modernizing my note-taking process. My end goal is to make my handwritten notes searchable.
It seems the reMarkable is doing some sort of line simplification before sending the raw x, y coordinates to the MyScript Handwriting Recognition Service (HWR) service.
The following images show initial plotting of the line segments from the binary lines files vs the data sent by the tablet to the HWR service:"><meta property="og:type" content="article"><meta property="og:url" content="https://techplexlabs.com/posts/remarkable-line-simplification/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-30T13:17:49-05:00"><meta property="article:modified_time" content="2021-01-30T13:17:49-05:00"><link rel=stylesheet href=/scss/hyde-hyde.71157e768c4e111a23c3531b95e0cbb59bbef3c9e6901d36247cb53d6b6be258.css integrity="sha256-cRV+doxOERojw1MbleDLtZu+88nmkB02JHy1PWtr4lg="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><style type=text/css>div.highlight{line-height:1.1rem;width:825px}div.highlight pre{padding:10px 0}code{background-color:initial!important;color:inherit!important}pre{margin:0}div.highlight table tbody td:nth-child(2) pre{width:1000px}pre code span:first-child{margin-left:-8px}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:inherit!important}</style><link rel=stylesheet type=text/css href=/css/monokai.css></head><body><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://techplexlabs.com/><img src=https://techplexlabs.com/img/TPL%20Logo.svg alt="Logo Image" class=element--center></a></span><p class=site__description>Lets make something!</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Techplex Labs</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/posts/><span>Posts</span></a></li><li><a href=/about/><span>About</span></a></li></ul></div><section class=social><a href=https://github.com/TechplexEngineer rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a>
<a href=https://linkedin.com/in/blakebourque rel=me><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2021 Blake
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div></div></div><div class="content container"><article><header><h1>Remarkable Line Simplification</h1><div class=post__meta><i class="fas fa-calendar-alt"></i> Jan 30, 2021
in
<a class="badge badge-category" href=/categories/reverse-engineering>REVERSE ENGINEERING</a><br><i class="fas fa-tags"></i>
<a class="badge badge-tag" href=/tags/remarkable>remarkable</a><br><i class="fas fa-clock"></i> 3 min read</div></header><div class=post><p>I recently purchased a reMarkable 2 e-ink tablet with the goal of modernizing my note-taking process. My end goal is to make my handwritten notes searchable.</p><p>It seems the reMarkable is doing some sort of line simplification before sending the raw x, y coordinates to the <a href=https://developer.myscript.com/getting-started>MyScript Handwriting Recognition Service (HWR) service.</a></p><p>The following images show initial plotting of the line segments from the binary lines files vs the data sent by the tablet to the HWR service:</p><p><img src=full-page-compare.png alt="Full Page">
<img src=handwriting-compare.png alt="Zoom in on Handwriting">
<img src=hand-compare.png alt="Zoom in on Hand"></p><p>These images show the difference between the raw data and what the tablet is sending to the HWR service.</p><p>The above images were generated with matplotlib, here is the script:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>matplotlib</span>
<span class=kn>import</span> <span class=nn>numpy</span> <span class=kn>as</span> <span class=nn>np</span>
<span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=kn>as</span> <span class=nn>plt</span>
<span class=kn>import</span> <span class=nn>json</span><span class=o>,</span> <span class=nn>sys</span><span class=o>,</span> <span class=nn>time</span>

<span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
    <span class=n>fig</span><span class=p>,</span> <span class=p>(</span><span class=n>ax1</span><span class=p>,</span> <span class=n>ax2</span><span class=p>)</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=c1># one row of two subplots</span>

    <span class=n>ax1</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Raw Data&#39;</span><span class=p>)</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./raw.json&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>hwrdata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>stroke</span> <span class=ow>in</span> <span class=n>hwrdata</span><span class=p>[</span><span class=s2>&#34;strokeGroups&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;strokes&#39;</span><span class=p>]:</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;x&#39;</span><span class=p>],</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;y&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;-o&#39;</span><span class=p>)</span>
    <span class=c1># ---------------------</span>
    <span class=n>ax3</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Tablet Smoothed Data&#39;</span><span class=p>)</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./tablet.json&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>hwrdata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>stroke</span> <span class=ow>in</span> <span class=n>hwrdata</span><span class=p>[</span><span class=s2>&#34;strokeGroups&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;strokes&#39;</span><span class=p>]:</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;x&#39;</span><span class=p>],</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;y&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;-o&#39;</span><span class=p>)</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>

<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
    <span class=n>main</span><span class=p>()</span>
</code></pre></td></tr></table></div></div><p>Initial searching took me to <a href=https://stackoverflow.com/a/26615039>this Stack Overflow post</a></p><p>The example Mike Bostock made showing the use of an algorithm for cartographic simplification, <a href=https://bost.ocks.org/mike/simplify/>be sure to check out this demo</a>.</p><p>Mike&rsquo;s demo took me to the <a href=https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm#Pseudocode>Wikipedia entry for the Ramer Douglas Peucker</a> (RDP) algorithm. Just below the psuedocode there is a link to a great <a href=https://karthaus.nl/rdp/>demo by Marius Karthaus</a> which is worth playing with. By playing with Marius' demo I became convinced that the RDP algorithm warranted some testing.</p><p>Expanding on the script from above to add a third subplot using the RDP algorithm to filter the points.</p><p><img src=rdp-full-page.png alt="Full Page with RDP">
<img src=rdp-handwriting.png alt="Zoom in on Handwriting with RDP">
<img src=rdp-hand.png alt="Zoom in on Hand with RDP"></p><p>Here is the python script with the addition of RDP:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>matplotlib</span>
<span class=kn>import</span> <span class=nn>numpy</span> <span class=kn>as</span> <span class=nn>np</span>
<span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=kn>as</span> <span class=nn>plt</span>
<span class=kn>import</span> <span class=nn>json</span>
<span class=kn>import</span> <span class=nn>sys</span>
<span class=kn>import</span> <span class=nn>time</span>

<span class=c1># Ramer–Douglas–Peucker algorithm</span>
<span class=kn>from</span> <span class=nn>rdp</span> <span class=kn>import</span> <span class=n>rdp</span>


<span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
    <span class=n>fig</span><span class=p>,</span> <span class=p>(</span><span class=n>ax1</span><span class=p>,</span> <span class=n>ax2</span><span class=p>,</span> <span class=n>ax3</span><span class=p>)</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=c1># one row of three subplots</span>


    <span class=n>ax1</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Raw Data&#39;</span><span class=p>)</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./raw.json&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>hwrdata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>stroke</span> <span class=ow>in</span> <span class=n>hwrdata</span><span class=p>[</span><span class=s2>&#34;strokeGroups&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;strokes&#39;</span><span class=p>]:</span>
        <span class=n>ax1</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;x&#39;</span><span class=p>],</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;y&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;-o&#39;</span><span class=p>)</span>
        <span class=c1># break</span>

    <span class=c1># ---------------------</span>

    <span class=n>epsilon</span><span class=o>=</span><span class=mi>10</span>
    <span class=n>ax2</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Ramer Douglas Peucker w/ epsilon={}&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>epsilon</span><span class=p>))</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./raw.json&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>hwrdata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>stroke</span> <span class=ow>in</span> <span class=n>hwrdata</span><span class=p>[</span><span class=s2>&#34;strokeGroups&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;strokes&#39;</span><span class=p>]:</span>
        <span class=n>x</span> <span class=o>=</span> <span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;x&#39;</span><span class=p>]</span>
        <span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;y&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=o>-</span><span class=mi>1</span>

        <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>((</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span>

        <span class=n>res</span> <span class=o>=</span> <span class=n>rdp</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>epsilon</span><span class=o>=</span><span class=n>epsilon</span><span class=p>)</span>
        <span class=n>res</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>

        <span class=n>ax2</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>res</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=s1>&#39;-o&#39;</span><span class=p>)</span>

    <span class=c1># ---------------------</span>

    <span class=n>ax3</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Tablet Smoothed Data&#39;</span><span class=p>)</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./tablet.json&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>hwrdata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>stroke</span> <span class=ow>in</span> <span class=n>hwrdata</span><span class=p>[</span><span class=s2>&#34;strokeGroups&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;strokes&#39;</span><span class=p>]:</span>
        <span class=n>ax3</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;x&#39;</span><span class=p>],</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>stroke</span><span class=p>[</span><span class=s1>&#39;y&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;-o&#39;</span><span class=p>)</span>

    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>

<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
    <span class=n>main</span><span class=p>()</span>
</code></pre></td></tr></table></div></div><p>Link to sample of <a href=raw.json>raw.json</a> and here is <a href=tablet.json>tablet.json</a></p><p>By visual inspection it appears the RDP with epsilon of 10 achieves the desired goal of closely matching the tablet-generated set of points.</p></div><div class="navigation navigation-single"><a href=/posts/what-are-the-red-green-bars-xlights/ class=navigation-prev><i aria-hidden=true class="fa fa-chevron-left"></i>
<span class=navigation-tittle>What Are the Red Green Bars on effects in xLights</span></a>
<a href=/posts/onshape-featurescript-frc/ class=navigation-next><span class=navigation-tittle>Onshape Featurescript FRC</span>
<i aria-hidden=true class="fa fa-chevron-right"></i></a></div></article></div><script defer src=https://use.fontawesome.com/releases/v5.12.1/js/all.js integrity=sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR crossorigin=anonymous></script></body></html>